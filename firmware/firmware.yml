---
-
   hosts: cobalt-infra11
   gather_facts: yes
   become: yes
   remote_user: vagrant
   ignore_errors: yes

   tasks:
     - name: test1
       block:
       - shell: dmidecode -t1 | egrep 'Manufacturer|Product Name|Serial Number'; dmidecode -t bios | grep -i revision
         register: dmidecode_XL170r
       - set_fact:
          var_dmidecode_XL170r_bios={{dmidecode_XL170r.stdout_lines[3].split(':')[1]|trim|default(omit)}}
       - set_fact:
          var_dmidecode_XL170r_firmware={{dmidecode_XL170r.stdout_lines[4].split(':')[1]|trim|default(omit)}}
       - set_fact:
          outdated="UPDATE FIRMWARE!!!!!"
         when: var_dmidecode_XL170r_bios == "2.0" and var_dmidecode_XL170r_firmware == "2.5"
       - debug:
           msg:
           - "{{ansible_product_name}}"
           - "{{outdated|default(omit)}}"
           - "BIOS: {{var_dmidecode_XL170r_bios|default(omit)}}"
           - "Firmware: {{var_dmidecode_XL170r_firmware|default(omit)}}"
       when: ansible_product_name == "ProLiant XL170r Gen9"

     - name: test2
       block:
       - shell: dmidecode -t1 | egrep 'Manufacturer|Product Name|Serial Number'; dmidecode -t bios | grep -i revision
         register: dmidecode_XL270d
       - set_fact:
          var_dmidecode_XL270d_bios={{dmidecode_XL270d.stdout_lines[3].split(':')[1]|trim|default(omit)}}
       - set_fact:
          var_dmidecode_XL270d_firmware={{dmidecode_XL270d.stdout_lines[4].split(':')[1]|trim|default(omit)}}
       - debug:
           msg:
           - "{{ansible_product_name}}"
           - "BIOS: {{var_dmidecode_XL270d_bios|default(omit)}}"
           - "Firmware: {{var_dmidecode_XL270d_firmware|default(omit)}}"
#      - debug: msg="BIOS:{{var_dmidecode_XL270d_bios|default(omit)}} and Firmware:{{var_dmidecode_XL270d_firmware|default(omit)}}"
#        when: var_dmidecode_XL270d_bios <= "2.44" or var_dmidecode_XL270d_firmware <= "2.0"
#       - debug: msg="Firmware: {{var_dmidecode_XL270d_firmware|default(omit)}}"
       when: ansible_product_name == "ProLiant XL270d Gen9"
